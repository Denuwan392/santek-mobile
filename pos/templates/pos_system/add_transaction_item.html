{% extends 'pos_system/base.html' %}

{% block title %}Add Item to Transaction{% endblock %}

{% block content %}
<h2>Add Item to Transaction {{ transaction.id }}</h2>

<form method="post">
    {% csrf_token %}
    
    <div class="form-group">
        <label for="serial_number">Enter Serial Number</label>
        <input type="text" class="form-control" id="serial_number" name="serial_number" required>
    </div>

    <input type="hidden" id="item_id" name="item">

    <div class="form-group">
        <label for="name">Item</label>
        <input type="text" class="form-control" id="name" readonly>
    </div>

    <div class="form-group">
        <label for="price">Price</label>
        <input type="text" class="form-control" id="price" name="price" readonly>
    </div>

    <div class="form-group">
        <label for="quantity">Quantity</label>
        <input type="number" class="form-control" id="quantity" name="quantity" min="1" value="1" required>
    </div>
    
    <button type="submit" class="btn btn-primary">Add Item</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const serialInput = document.getElementById('serial_number');
        const itemIdInput = document.getElementById('item_id');
        const nameInput = document.getElementById('name');
        const priceInput = document.getElementById('price');
        const quantityInput = document.getElementById('quantity');

        serialInput.addEventListener('change', function() {
            const serialNumber = serialInput.value;

            fetch(`/get_item_by_serial/?serial_number=${serialNumber}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        itemIdInput.value = data.item_id;
                        nameInput.value = data.name;
                        priceInput.value = data.price;
                        quantityInput.value = data.quantity;
                    }
                })
                .catch(error => {
                    console.error('Error fetching item data:', error);
                });
        });
    });
</script>
{% endblock %}
