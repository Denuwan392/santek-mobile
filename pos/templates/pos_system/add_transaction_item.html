{% extends 'pos_system/base.html' %}

{% block title %}Add Item to Transaction{% endblock %}

{% block content %}
<h2>Add Item to Transaction {{ transaction.id }}</h2>

<form method="post">
    {% csrf_token %}
    
    <div class="form-group">
        <label for="serial_number">Enter Serial Number</label>
        <input type="text" class="form-control" id="serial_number" name="serial_number" required>
    </div>

    <div class="form-group">
        <label for="item">Item</label>
        <select class="form-control" id="item" name="item" readonly>
            {% for item in items %}
                <option value="{{ item.id }}">{{ item.name }} - Rs.{{ item.retail_selling_price }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="quantity">Quantity</label>
        <input type="number" class="form-control" id="quantity" name="quantity" min="1" value="1" required>
    </div>

    <div class="form-group">
        <label for="price">Price</label>
        <input type="text" class="form-control" id="price" name="price" readonly>
    </div>
    
    <button type="submit" class="btn btn-primary">Add Item</button>
</form>

<h3>Available Items</h3>
<table class="table">
    <thead>
        <tr>
            <th>Item Name</th>
            <th>Price</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td>{{ item.name }}</td>
            <td>Rs. {{ item.retail_selling_price }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const serialInput = document.getElementById('serial_number');
        const itemSelect = document.getElementById('item');
        const quantityInput = document.getElementById('quantity');
        const priceInput = document.getElementById('price');

        const serialItemMap = {{ serial_item_map|safe }};

        serialInput.addEventListener('input', function() {
            const serialNumber = serialInput.value;
            const itemData = serialItemMap[serialNumber] || null;

            if (itemData) {
                itemSelect.value = itemData.item_id;
                quantityInput.value = itemData.quantity;
                priceInput.value = itemData.price;
            } else {
                itemSelect.value = '';
                quantityInput.value = 1;
                priceInput.value = '';
            }
        });
    });
</script>
{% endblock %}
